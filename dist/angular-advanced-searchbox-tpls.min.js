/*! 
 * angular-advanced-searchbox v3.0.0
 * https://github.com/dnauck/angular-advanced-searchbox
 * Copyright (c) 2016 Nauck IT KG http://www.nauck-it.de/
 * License: MIT
 */
!function(){"use strict";angular.module("angular-advanced-searchbox",[]).directive("nitAdvancedSearchbox",function(){return{restrict:"E",scope:{model:"=ngModel",parameters:"=",parametersLabel:"@",parametersDisplayLimit:"=?",placeholder:"@",searchThrottleTime:"=?"},replace:!0,templateUrl:function(a,b){return b.templateUrl||"angular-advanced-searchbox.html"},controller:["$scope","$attrs","$element","$timeout","$filter","setFocusFor",function(a,b,c,d,e,f){function g(){angular.forEach(a.model,function(b,c){if("query"===c)a.searchQuery=b;else{var d=e("filter")(a.parameters,function(a){return a.key===c})[0];void 0!==d&&a.addSearchParam(d,b,!1)}})}function h(b,c,f,g){j&&d.cancel(j),k=e("filter")(k,function(a){return a.key!==c&&a.index!==f}),k.push({command:b,key:c,index:f,value:g}),j=d(function(){angular.forEach(k,function(b){var d=e("filter")(a.parameters,function(a){return a.key===c})[0];if(d&&angular.isObject(b.value)){var f=d.viewKey;b.value.viewKey=f}d&&d.allowMultiple?(angular.isArray(a.model[b.key])||(a.model[b.key]=[]),"delete"===b.command?(a.model[b.key].splice(b.index,1),0===a.model[b.key].length&&delete a.model[b.key]):a.model[b.key][b.index]=b.value):"delete"===b.command?delete a.model[b.key]:a.model[b.key]=b.value}),k.length=0,a.$emit("advanced-searchbox:modelUpdated",a.model)},a.searchThrottleTime)}function i(a){if(!a)return 0;try{if("number"==typeof a.selectionStart)return"backward"===a.selectionDirection?a.selectionStart:a.selectionEnd;if(document.selection){a.focus();var b=document.selection.createRange(),c=document.selection.createRange().text.length;return b.moveStart("character",-a.value.length),b.text.length-c}}catch(d){}return 0}a.parametersLabel=a.parametersLabel||"Parameter Suggestions",a.parametersDisplayLimit=a.parametersDisplayLimit||8,a.placeholder=a.placeholder||"Search ...",a.searchThrottleTime=a.searchThrottleTime||1e3,a.searchParams=[],a.searchQuery="",a.setFocusFor=f;var j,k=[];a.$watch("model",function(b,c){if(!angular.equals(b,c)){angular.forEach(a.model,function(b,c){if("query"===c&&a.searchQuery!==b)a.searchQuery=b;else{var d=e("filter")(a.parameters,function(a){return a.key===c})[0],f=e("filter")(a.searchParams,function(a){return a.key===c});if(void 0!==d)if(d.allowMultiple){if(angular.isArray(b)||(b=[b]),b.forEach(function(b,c){if(f.some(function(a){return a.index===c})){var e=f.filter(function(a){return a.index===c});e[0].value!==b&&(e[0].value=b)}else a.addSearchParam(d,b,!1)}),b.length<f.length)for(var g=b.length;g<f.length;g++)a.removeSearchParam(a.searchParams.indexOf(f[g]))}else 0===f.length?a.addSearchParam(d,b,!1):f[0].value!==b&&(f[0].value=b)}});for(var d=a.searchParams.length-1;d>=0;d--){var f=a.searchParams[d];if(!a.model.hasOwnProperty(f.key)){var g=a.searchParams.map(function(a){return a.key}).indexOf(f.key);a.removeSearchParam(g)}}}},!0),a.searchParamValueChanged=function(a){h("change",a.key,a.index,a.value)},a.searchQueryChanged=function(a){h("change","query",0,a)},a.enterEditMode=function(b,c){if(void 0!==b&&b.stopPropagation(),void 0!==c){var d=a.searchParams[c];d.editMode=!0,f("searchParam:"+d.key),a.$emit("advanced-searchbox:enteredEditMode",d)}},a.leaveEditMode=function(b,c){if(void 0!==c){var d=a.searchParams[c];d.editMode=!1,a.$emit("advanced-searchbox:leavedEditMode",d),d.value||a.removeSearchParam(c)}},a.searchQueryTypeaheadOnSelect=function(b,c,d){a.addSearchParam(b),a.searchQuery="",h("delete","query",0)},a.searchParamTypeaheadOnSelect=function(b,c){c.value=b,a.searchParamValueChanged(c)},a.isUnsedParameter=function(b,c){return 0===e("filter")(a.searchParams,function(a){return a.key===b.key&&!a.allowMultiple}).length},a.addSearchParam=function(b,c,f){if(void 0===f&&(f=!0),a.isUnsedParameter(b)){var g=0;b.allowMultiple&&(g=e("filter")(a.searchParams,function(a){return a.key===b.key}).length);var i=a.searchParams.push({key:b.key,viewKey:b.viewKey,viewValue:b.viewValue,name:b.name,type:b.type||"text",placeholder:b.placeholder,allowMultiple:b.allowMultiple||!1,suggestedValues:b.suggestedValues||[],restrictToSuggestedValues:b.restrictToSuggestedValues||!1,index:g,value:c||""})-1;h("add",b.key,g,c),f===!0&&d(function(){a.enterEditMode(void 0,i)},100),a.$emit("advanced-searchbox:addedSearchParam",b)}},a.removeSearchParam=function(b){if(void 0!==b){var c=a.searchParams[b];if(a.searchParams.splice(b,1),c.allowMultiple)for(var d=e("filter")(a.searchParams,function(a){return a.key===c.key}),f=0;f<d.length;f++)d[f].index=f;h("delete",c.key,c.index),a.$emit("advanced-searchbox:removedSearchParam",c)}},a.removeAll=function(){a.searchParams.length=0,a.searchQuery="",a.model={},a.$emit("advanced-searchbox:removedAllSearchParam")},a.editPrevious=function(b){void 0!==b&&a.leaveEditMode(void 0,b),b>0?a.enterEditMode(void 0,b-1):a.searchParams.length>0?a.enterEditMode(void 0,a.searchParams.length-1):0===a.searchParams.length&&f("searchbox")},a.editNext=function(b){void 0!==b&&(a.leaveEditMode(void 0,b),b<a.searchParams.length-1?a.enterEditMode(void 0,b+1):f("searchbox"))},a.keydown=function(b,c){var d=[8,9,13,37,39];if(-1!==d.indexOf(b.which)){var e=i(b.target);8==b.which?0===e&&(b.preventDefault(),a.editPrevious(c)):9==b.which?b.shiftKey?(b.preventDefault(),a.editPrevious(c)):(b.preventDefault(),a.editNext(c)):13==b.which?a.editNext(c):37==b.which?0===e&&a.editPrevious(c):39==b.which&&e===b.target.value.length&&a.editNext(c)}},void 0===a.model?a.model={}:g()}]}}).directive("setFocusOn",[function(){return{restrict:"A",link:function(a,b,c){return a.$on("advanced-searchbox:setFocusOn",function(a,d){return d===c.setFocusOn?b[0].focus():void 0})}}}]).factory("setFocusFor",["$rootScope","$timeout",function(a,b){return function(c){return b(function(){return a.$broadcast("advanced-searchbox:setFocusOn",c)})}}]).directive("nitAutoSizeInput",["$timeout",function(a){return{restrict:"A",scope:{model:"=ngModel"},link:function(b,c,d){function e(){a(function(){-1!==f.indexOf(c[0].type||"text")&&(h.text(c.val()||c.attr("placeholder")),c.css("width",h.outerWidth()+10))})}var f=["text","search","tel","url","email","password","number"],g=angular.element('<div style="position: fixed; top: -9999px; left: 0px;"></div>'),h=angular.element('<span style="white-space:pre;"></span>'),i="none"===c.css("maxWidth")?c.parent().innerWidth():c.css("maxWidth");c.css("maxWidth",i),angular.forEach(["fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","boxSizing","borderLeftWidth","borderRightWidth","borderLeftStyle","borderRightStyle","paddingLeft","paddingRight","marginLeft","marginRight"],function(a){h.css(a,c.css(a))}),angular.element("body").append(g.append(h)),e(),b.model?b.$watch("model",function(){e()}):c.on("keypress keyup keydown focus input propertychange change",function(){e()})}}}])}(),angular.module("angular-advanced-searchbox").run(["$templateCache",function(a){"use strict";a.put("angular-advanced-searchbox.html",'<div class=advancedSearchBox ng-class={active:focus} ng-init="focus = false" ng-click="!focus ? setFocusFor(\'searchbox\') : null"><span ng-show="searchParams.length < 1 && searchQuery.length === 0" class="search-icon glyphicon glyphicon-search"></span> <a ng-href="" ng-show="searchParams.length > 0 || searchQuery.length > 0" ng-click=removeAll() role=button><span class="remove-all-icon glyphicon glyphicon-trash"></span></a><div><div class=search-parameter ng-repeat="searchParam in searchParams"><a ng-href="" ng-click=removeSearchParam($index) role=button><span class="remove glyphicon glyphicon-trash"></span></a><div class=key data-key={{searchParam.key}} ng-click="enterEditMode($event, $index)">{{searchParam.name}}:</div><div class=value><span ng-show=!searchParam.editMode ng-click="enterEditMode($event, $index)">{{searchParam.value}}</span> <input name=value type={{searchParam.type}} nit-auto-size-input set-focus-on="{{\'searchParam:\' + searchParam.key}}" ng-keydown="keydown($event, $index)" ng-blur="leaveEditMode($event, $index)" ng-show=searchParam.editMode ng-change="searchParam.restrictToSuggestedValues !== true ? searchParamValueChanged(searchParam) : null" ng-model=searchParam.value uib-typeahead="suggestedValue for suggestedValue in searchParam.suggestedValues | filter:$viewValue" typeahead-min-length=0 typeahead-on-select="searchParamTypeaheadOnSelect($item, searchParam)" typeahead-editable="searchParam.restrictToSuggestedValues !== true" typeahead-select-on-exact=true typeahead-select-on-blur="searchParam.restrictToSuggestedValues !== true ? false : true" placeholder="{{searchParam.placeholder}}"></div></div><input name=searchbox class=search-parameter-input nit-auto-size-input set-focus-on=searchbox ng-keydown=keydown($event) placeholder={{placeholder}} ng-focus="focus = true" ng-blur="focus = false" uib-typeahead="parameter as parameter.name for parameter in parameters | filter:isUnsedParameter | filter:{name:$viewValue} | limitTo:parametersDisplayLimit" typeahead-on-select="searchQueryTypeaheadOnSelect($item, $model, $label)" ng-change=searchQueryChanged(searchQuery) ng-model="searchQuery"></div><div class=search-parameter-suggestions ng-show="parameters && focus"><span class=title>{{parametersLabel}}:</span> <span class=search-parameter ng-repeat="param in parameters | filter:isUnsedParameter | limitTo:parametersDisplayLimit" data-key={{param.key}} ng-mousedown=addSearchParam(param)>{{param.name}} <i ng-class="{\'glyphicon glyphicon-plus\': param.allowMultiple}"></i></span></div></div>')}]);