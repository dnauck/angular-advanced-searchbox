/*! 
 * angular-advanced-searchbox v3.0.1
 * https://github.com/dnauck/angular-advanced-searchbox
 * Copyright (c) 2018 Nauck IT KG http://www.nauck-it.de/
 * License: MIT
 */

!function(){"use strict";angular.module("angular-advanced-searchbox",[]).directive("nitAdvancedSearchbox",function(){return{restrict:"E",scope:{model:"=ngModel",parameters:"=",parametersLabel:"@",parametersDisplayLimit:"=?",placeholder:"@",searchThrottleTime:"=?"},replace:!0,templateUrl:function(e,a){return a.templateUrl||"angular-advanced-searchbox.html"},controller:["$scope","$attrs","$element","$timeout","$filter","setFocusFor",function(i,e,a,s,c,t){var n;i.parametersLabel=i.parametersLabel||"Parameter Suggestions",i.parametersDisplayLimit=i.parametersDisplayLimit||8,i.placeholder=i.placeholder||"Search ...",i.searchThrottleTime=i.searchThrottleTime||1e3,i.searchParams=[],i.searchQuery="",i.setFocusFor=t;var o=[];function l(e,r,a,t){n&&s.cancel(n),(o=c("filter")(o,function(e){return e.key!==r&&e.index!==a})).push({command:e,key:r,index:a,value:t}),n=s(function(){angular.forEach(o,function(e){var a=c("filter")(i.parameters,function(e){return e.key===r})[0];a&&a.allowMultiple?(angular.isArray(i.model[e.key])||(i.model[e.key]=[]),"delete"===e.command?(i.model[e.key].splice(e.index,1),0===i.model[e.key].length&&delete i.model[e.key]):i.model[e.key][e.index]=e.value):"delete"===e.command?delete i.model[e.key]:i.model[e.key]=e.value}),o.length=0,i.$emit("advanced-searchbox:modelUpdated",i.model)},i.searchThrottleTime)}i.$watch("model",function(e,a){if(!angular.equals(e,a)){angular.forEach(i.model,function(e,a){if("query"===a&&i.searchQuery!==e)i.searchQuery=e;else{var t=c("filter")(i.parameters,function(e){return e.key===a})[0],n=c("filter")(i.searchParams,function(e){return e.key===a});if(void 0!==t)if(t.allowMultiple){if(angular.isArray(e)||(e=[e]),e.forEach(function(e,a){if(n.some(function(e){return e.index===a})){var r=n.filter(function(e){return e.index===a});r[0].value!==e&&(r[0].value=e)}else i.addSearchParam(t,e,!1)}),e.length<n.length)for(var r=e.length;r<n.length;r++)i.removeSearchParam(i.searchParams.indexOf(n[r]))}else 0===n.length?i.addSearchParam(t,e,!1):n[0].value!==e&&(n[0].value=e)}});for(var r=i.searchParams.length-1;0<=r;r--){var t=i.searchParams[r];if(!i.model.hasOwnProperty(t.key)){var n=i.searchParams.map(function(e){return e.key}).indexOf(t.key);i.removeSearchParam(n)}}}},!0),i.searchParamValueChanged=function(e){l("change",e.key,e.index,e.value)},i.searchQueryChanged=function(e){l("change","query",0,e)},i.enterEditMode=function(e,a){if(void 0!==e&&e.stopPropagation(),void 0!==a){var r=i.searchParams[a];r.editMode=!0,t("searchParam:"+r.key),i.$emit("advanced-searchbox:enteredEditMode",r)}},i.leaveEditMode=function(e,a){if(void 0!==a){var r=i.searchParams[a];r.editMode=!1,i.$emit("advanced-searchbox:leavedEditMode",r),r.value||i.removeSearchParam(a)}},i.searchQueryTypeaheadOnSelect=function(e,a,r){i.addSearchParam(e),i.searchQuery="",l("delete","query",0)},i.searchParamTypeaheadOnSelect=function(e,a){a.value=e,i.searchParamValueChanged(a)},i.isUnsedParameter=function(a,e){return 0===c("filter")(i.searchParams,function(e){return e.key===a.key&&!e.allowMultiple}).length},i.addSearchParam=function(a,e,r){if(void 0===r&&(r=!0),i.isUnsedParameter(a)){var t=0;a.allowMultiple&&(t=c("filter")(i.searchParams,function(e){return e.key===a.key}).length);var n=i.searchParams.push({key:a.key,name:a.name,type:a.type||"text",placeholder:a.placeholder,allowMultiple:a.allowMultiple||!1,suggestedValues:a.suggestedValues||[],restrictToSuggestedValues:a.restrictToSuggestedValues||!1,index:t,value:e||""})-1;l("add",a.key,t,e),!0===r&&s(function(){i.enterEditMode(void 0,n)},100),i.$emit("advanced-searchbox:addedSearchParam",a)}},i.removeSearchParam=function(e){if(void 0!==e){var a=i.searchParams[e];if(i.searchParams.splice(e,1),a.allowMultiple)for(var r=c("filter")(i.searchParams,function(e){return e.key===a.key}),t=0;t<r.length;t++)r[t].index=t;l("delete",a.key,a.index),i.$emit("advanced-searchbox:removedSearchParam",a)}},i.removeAll=function(){i.searchParams.length=0,i.searchQuery="",i.model={},i.$emit("advanced-searchbox:removedAllSearchParam")},i.editPrevious=function(e){void 0!==e&&i.leaveEditMode(void 0,e),0<e?i.enterEditMode(void 0,e-1):0<i.searchParams.length?i.enterEditMode(void 0,i.searchParams.length-1):0===i.searchParams.length&&t("searchbox")},i.editNext=function(e){void 0!==e&&(i.leaveEditMode(void 0,e),e<i.searchParams.length-1?i.enterEditMode(void 0,e+1):t("searchbox"))},i.keydown=function(e,a){if(-1!==[8,9,13,37,39].indexOf(e.which)){var r=function(e){if(!e)return 0;try{if("number"==typeof e.selectionStart)return"backward"===e.selectionDirection?e.selectionStart:e.selectionEnd;if(document.selection){e.focus();var a=document.selection.createRange(),r=document.selection.createRange().text.length;return a.moveStart("character",-e.value.length),a.text.length-r}}catch(e){}return 0}(e.target);8==e.which?0===r&&(e.preventDefault(),i.editPrevious(a)):9==e.which?e.shiftKey?(e.preventDefault(),i.editPrevious(a)):(e.preventDefault(),i.editNext(a)):13==e.which?i.editNext(a):37==e.which?0===r&&i.editPrevious(a):39==e.which&&r===e.target.value.length&&i.editNext(a)}},void 0===i.model?i.model={}:angular.forEach(i.model,function(e,a){if("query"===a)i.searchQuery=e;else{var r=c("filter")(i.parameters,function(e){return e.key===a})[0];void 0!==r&&i.addSearchParam(r,e,!1)}})}]}}).directive("setFocusOn",[function(){return{restrict:"A",link:function(e,r,t){return e.$on("advanced-searchbox:setFocusOn",function(e,a){if(a===t.setFocusOn)return r[0].focus()})}}}]).factory("setFocusFor",["$rootScope","$timeout",function(a,r){return function(e){return r(function(){return a.$broadcast("advanced-searchbox:setFocusOn",e)})}}]).directive("nitAutoSizeInput",["$timeout",function(o){return{restrict:"A",scope:{model:"=ngModel"},link:function(e,a,r){var t=["text","search","tel","url","email","password","number"],n=angular.element('<div style="position: fixed; top: -9999px; left: 0px;"></div>'),i=angular.element('<span style="white-space:pre;"></span>'),s="none"===a.css("maxWidth")?a.parent().innerWidth():a.css("maxWidth");function c(){o(function(){-1!==t.indexOf(a[0].type||"text")&&(i.text(a.val()||a.attr("placeholder")),a.css("width",i.outerWidth()+10))})}a.css("maxWidth",s),angular.forEach(["fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","boxSizing","borderLeftWidth","borderRightWidth","borderLeftStyle","borderRightStyle","paddingLeft","paddingRight","marginLeft","marginRight"],function(e){i.css(e,a.css(e))}),angular.element("body").append(n.append(i)),c(),e.model?e.$watch("model",function(){c()}):a.on("keypress keyup keydown focus input propertychange change",function(){c()})}}}])}(),angular.module("angular-advanced-searchbox").run(["$templateCache",function(e){"use strict";e.put("angular-advanced-searchbox.html",'<div class=advancedSearchBox ng-class={active:focus} ng-init="focus = false" ng-click="!focus ? setFocusFor(\'searchbox\') : null"><span ng-show="searchParams.length < 1 && searchQuery.length === 0" class="search-icon glyphicon glyphicon-search"></span> <a ng-href="" ng-show="searchParams.length > 0 || searchQuery.length > 0" ng-click=removeAll() role=button><span class="remove-all-icon glyphicon glyphicon-trash"></span></a><div><div class=search-parameter ng-repeat="searchParam in searchParams"><a ng-href="" ng-click=removeSearchParam($index) role=button><span class="remove glyphicon glyphicon-trash"></span></a><div class=key data-key={{searchParam.key}} ng-click="enterEditMode($event, $index)">{{searchParam.name}}:</div><div class=value><span ng-show=!searchParam.editMode ng-click="enterEditMode($event, $index)">{{searchParam.value}}</span> <input name=value type={{searchParam.type}} nit-auto-size-input set-focus-on="{{\'searchParam:\' + searchParam.key}}" ng-keydown="keydown($event, $index)" ng-blur="leaveEditMode($event, $index)" ng-show=searchParam.editMode ng-change="searchParam.restrictToSuggestedValues !== true ? searchParamValueChanged(searchParam) : null" ng-model=searchParam.value uib-typeahead="suggestedValue for suggestedValue in searchParam.suggestedValues | filter:$viewValue" typeahead-min-length=0 typeahead-on-select="searchParamTypeaheadOnSelect($item, searchParam)" typeahead-editable="searchParam.restrictToSuggestedValues !== true" typeahead-select-on-exact=true typeahead-select-on-blur="searchParam.restrictToSuggestedValues !== true ? false : true" placeholder={{searchParam.placeholder}}></div></div><input name=searchbox class=search-parameter-input nit-auto-size-input set-focus-on=searchbox ng-keydown=keydown($event) placeholder={{placeholder}} ng-focus="focus = true" ng-blur="focus = false" uib-typeahead="parameter as parameter.name for parameter in parameters | filter:isUnsedParameter | filter:{name:$viewValue} | limitTo:parametersDisplayLimit" typeahead-on-select="searchQueryTypeaheadOnSelect($item, $model, $label)" ng-change=searchQueryChanged(searchQuery) ng-model=searchQuery></div><div class=search-parameter-suggestions ng-show="parameters && focus"><span class=title>{{parametersLabel}}:</span> <span class=search-parameter ng-repeat="param in parameters | filter:isUnsedParameter | limitTo:parametersDisplayLimit" data-key={{param.key}} ng-mousedown=addSearchParam(param)>{{param.name}} <i ng-class="{\'glyphicon glyphicon-plus\': param.allowMultiple}"></i></span></div></div>')}]);